
	


	<main class="content">
		<div class="container-fluid p-0">

			<h1 class="h3 mb-3">
				<strong>실시간</strong> 현재 매출 현황
			</h1>

			<div class="row">
				<div class="col-xl-12 col-xxl-12 d-flex">
					<div class="w-100">
						<div class="row">
							<div class="col-sm-4">
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">실시간 배송량</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="truck"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3" id="nowShip"></h1>
										<div class="mb-0">
											<span class="text-danger" id="totalShip"> <i
												class="mdi mdi-arrow-bottom-right"></i> -3.65%
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">실시간 제품 판매수</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="users"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3" id="newItemCnt"></h1>
										<div class="mb-0">
											<span class="text-success"> <i
												class="mdi mdi-arrow-bottom-right" id="totalItemCnt"></i>
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-4">
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">실시간 판매액</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="dollar-sign"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3" id="nowTotalPrice"></h1>
										<div class="mb-0">
											<span class="text-success"> <i
												class="mdi mdi-arrow-bottom-right" id="totalTotalPrice"></i>
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">실시간 구매 확정률</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="shopping-cart"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3" id="nowConfirm"></h1>
										<div class="mb-0">
											<span class="text-danger"> <i
												class="mdi mdi-arrow-bottom-right" id="totalConfirm"></i>
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-4">
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">주문건당 평균 판매개수</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="truck"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3">201건</h1>
										<div class="mb-0">
											<span class="text-danger"> <i
												class="mdi mdi-arrow-bottom-right"></i> -3.65%
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">주문건당 평균 판매금액</h5>
											</div>

											<div class="col-auto">
												<div class="stat text-primary">
													<i class="align-middle" data-feather="users"></i>
												</div>
											</div>
										</div>
										<h1 class="mt-1 mb-3">14201명</h1>
										<div class="mb-0">
											<span class="text-success"> <i
												class="mdi mdi-arrow-bottom-right"></i> 5.25%
											</span> <span class="text-muted">누적</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				
				

				<div class="col-xl-12 col-xxl-12">
					<div class="card flex-fill w-100">
						<div class="card-header">
							<h5 class="card-title">2023-01-27</h5>
							<h6 class="card-subtitle text-muted">실시간 시간별 매출 차트</h6>
						</div>
						<div class="card-body py-3">
							<div class="chart chart-sm">
								<canvas id="chartjs-dashboard-line"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>




			<div class="row">
				





						<div class="col-12 col-lg-12">
							<div class="card">
								<div class="card-header">
									<h5 class="card-title">2023-01-27 실시간 전일 대비 판매금액</h5>
									<h6 class="card-subtitle text-muted">총 접속한 사용자와 실제로 구매까지 이어진 회원의 비율로 구합니다.</h6>
								</div>
								<div class="card-body">
									<div class="chart">
										<canvas id="chartjs-bar"></canvas>
									</div>
								</div>
							</div>
						</div>
							
							

					
					
					
					
				


			</div>

			<div class="row">
				<div class="col-6 col-lg-6 col-xxl-6 d-flex">
					<div class="card flex-fill">
						<div class="card-header">

							<h5 class="card-title mb-0">인기 판매 상품 TOP 10</h5>
						</div>
						<table class="table table-hover my-0">
							<thead>
								<tr>
									<th>상품명</th>
									<th class="d-none d-xl-table-cell">누적 금액</th>
									<th>할인률</th>
									<th class="d-none d-md-table-cell">상품가격</th>
									<th class="d-none d-xl-table-cell">현재까지 판매된 개수</th>
								</tr>
							</thead>
							
							<!-- 상품 리스트 -->
							<tbody id="belowList">
								<!-- <tr th:each="product : ${productList}" id="productTable">
									<td th:text=${product.name}>둘이 먹다 죽어도 모르는 한식 세트</td>
									<td th:text=${product.totPrice} class="d-none d-xl-table-cell">365,000원</td>
									<td th:text=${product.salePct}><span class="badge bg-success">70%</span></td>
									<th th:text=${product.sale} class="d-none d-md-table-cell">28,000원</th>
									<td th:text=${product.totCnt} class="d-none d-xl-table-cell">54개</td>
								</tr> -->
							</tbody>
						</table>
						
						
					</div>
				</div>
				
				
				<div class="col-3 col-md-3 col-xxl-3 d-flex order-2 order-xxl-3">
					<div class="card flex-fill w-100">
						<div class="card-header">

							<h5 th:if="${#strings.equals(gender, 'noGender')}" class="card-title mb-0">나이대별 판매 비율</h5>
							<h5 th:if="${#strings.equals(gender, '1,3')}" class="card-title mb-0">남성 나이대별 판매 비율</h5>
							<h5 th:if="${#strings.equals(gender, '2,4')}" class="card-title mb-0">여성 나이대별 판매 비율</h5>
							
							
							
						</div>
						<div class="card-body d-flex">
							<div class="align-self-center w-100">
								<div class="py-3">
									<div class="chart chart-xs">
										<canvas id="chartjs-dashboard-pie"></canvas>
									</div>
								</div>

								<table class="table mb-0">
									<tbody>
										<tr class="card-title" >
											<td>연령대</td>
											<td class="text-end">판매된 개수</td>
											
										</tr>
										
										<tr>
											
											<tr id="selected10">
											<td style="padding:0.1rem 0.1rem;">10대</td>
											<td th:text="${age10Sales} ? ${age10Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
											
											<tr id="selected20">
											<td style="padding:0.1rem 0.1rem;">20대</td>
											<td th:text="${age20Sales} ? ${age20Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
											
											
										</tr>
										
										<tr>
											
											<tr id="selected30">
											<td style="padding:0.1rem 0.1rem;">30대</td>
											<td th:text="${age30Sales} ? ${age30Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
											
											<tr id="selected40">
											<td style="padding:0.1rem 0.1rem;">40대</td>
											<td th:text="${age40Sales} ? ${age40Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
											
										</tr>
										<tr>
											<tr id="selected50">
											<td style="padding:0.1rem 0.1rem;">50대</td>
											<td th:text="${age50Sales} ? ${age50Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
											<tr id="selected60">
											<td style="padding:0.1rem 0.1rem;">60대</td>
											<td th:text="${age60Sales} ? ${age60Sales}+'개' : '0개'" class="text-end" style="padding:0.1rem 0.1rem;">4306개</td>
											</tr>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				
				
				
				<div class="col-3 col-md-3 col-xxl-3 d-flex order-2 order-xxl-3">
					<div class="card flex-fill w-100">
						<div class="card-header">

							<!-- <h5 th:if="${#strings.equals(gender,'noGender')} and ${#strings.equals(age,'noAge')}" class="card-title mb-0">남녀 판매 비율</h5>
							<h5 th:if="${#strings.equals(gender,'noGender')} and !${#strings.equals(age,'noAge')}" class="card-title mb-0" th:text="${age}+'대 남녀 판매 비율'"></h5>
							<h5 th:if="!${#strings.equals(gender,'noGender')} and !${#strings.equals(age,'noAge')}" class="card-title mb-0" th:text="${age}+'대 남녀 판매 비율'"></h5> -->
							
							<h5 th:if="${#strings.equals(age,'noAge')}" class="card-title mb-0">남녀 판매 비율</h5>
							<h5 th:if="!${#strings.equals(age,'noAge')}" th:text="${age} != null ? ${age}+'대 남녀 판매 비율' : '남녀 판매 비율'" class="card-title mb-0"></h5>
							
							
						</div>
						<div class="card-body d-flex">
							<div class="align-self-center w-100">
								<div class="py-3">
									<div class="chart chart-xs">
										<canvas id="chartjs-dashboard-pie2"></canvas>
									</div>
								</div>

								<table class="table mb-0">
									<tbody>
										<tr class="card-title">
											<td>성별</td>
											<td class="text-end">판매된 개수</td>
										</tr>
										<tr id="men">
											<td id="menCntTitle" style="padding:0.4rem 0.4rem;">남성</td>
											<td class="text-end" id="menCnt" style="padding:0.4rem 0.4rem;" th:text="${maleSales} ? ${maleSales}+'개' : '0개'"></td>
											
										</tr>
										<tr id="women">
											<td id="womenCntTitle" style="padding:0.4rem 0.4rem;">여성</td>
											<td class="text-end" id="womenCnt" style="padding:0.4rem 0.4rem;" th:text="${femaleSales} ? ${femaleSales}+'개' : '0개'"></td>
											
											
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				
				
			</div>

		</div>
	</main>
</div>
</div>


<script>
var lastDayChart;
function getRealTimeData(){	
	$.ajax({
		url:'/admin/getRealTimeData',
		method:'GET',
		dataType:'JSON',
		async: false,
		success: function(data){
			
			
			$('#nowShip').text(data.nowDash.totalShip);
			$('#totalShip').text(data.totalDash.totalShip);
			
			$('#newItemCnt').text(data.nowDash.totalItemCnt);
			$('#totalItemCnt').text(data.totalDash.totalItemCnt);	
			
			$('#nowTotalPrice').text(data.nowDash.totalPrice);
			$('#totalTotalPrice').text(data.totalDash.totalPrice);
			
			$('#nowConfirm').text(data.nowDash.confirmation+'%');
			$('#totalConfirm').text(data.totalDash.confirmation+'%');
			
			
			var resultList = new Array;
			var resultList = data.productList;
			
			var appendedList = '';
			
			$.each(resultList, function(key, value) {
				appendedList += '<tr>'; 
				appendedList += '<td>' + value.name + '</td>'; 
				appendedList += '<td>' + value.totPrice + '</td>'; 
				appendedList += '<td>' + value.salePct + '</td>'; 
				appendedList += '<td>' + value.sale + '</td>'; 
				appendedList += '<td>' + value.totCnt + '</td>'; 
				appendedList += '</tr>'; 
			});
			
			$('#belowList').html(appendedList);
			
			lastDayChart = data.lastDayChart;
			console.log(lastDayChart);
		}
		
	});
}


$(document).ready(function(){

	getRealTimeData();
		
	setInterval(function (){
		getRealTimeData();
		console.log(lastDayChart);
	}, 10000);

});




</script>




<script th:src="@{/js/app.js}"></script>


<script>

var age10 = '[[${age10Sales}]]';
var age20 = '[[${age20Sales}]]';
var age30 = '[[${age30Sales}]]';
var age40 = '[[${age40Sales}]]';
var age50 = '[[${age50Sales}]]';
var age60 = '[[${age60Sales}]]';


if(age10 == null) age10 = 0;
if(age20 == null) age20 = 0;
if(age30 == null) age30 = 0;
if(age40 == null) age40 = 0;
if(age50 == null) age50 = 0;
if(age60 == null) age60 = 0;


document.addEventListener("DOMContentLoaded", function() {
	// Pie chart
	new Chart(document.getElementById("chartjs-dashboard-pie"), {
		type : "bar",
		data : {
			labels : [ "10대", "20대", "30대", "40대", "50대", "60대" ],
			datasets : [ {
				data : [ age10, age20, age30, age40, age50, age60],
				backgroundColor : [window.theme.warning, window.theme.warning, window.theme.primary, window.theme.primary, window.theme.info, window.theme.info ],
				borderWidth : 5
			} ]
		},
		options : {
			responsive : !window.MSInputMethodContext,
			maintainAspectRatio : false,
			legend : {
				display : false
			},
			cutoutPercentage : 75
			
		}
	});
});
</script>
<script>
var maleSales = '[[${maleSales}]]';
if(maleSales == null) maleSales = 1;

var femaleSales = '[[${femaleSales}]]';
if(femaleSales == null) femaleSales = 1;

document.addEventListener("DOMContentLoaded", function() {
	// Pie chart
	new Chart(document.getElementById("chartjs-dashboard-pie2"), {
		type : "pie",
		data : {
			labels : [ "남성 (개수)", "여성 (개수)"],
			datasets : [ {
				data : [ maleSales, femaleSales],
				backgroundColor : [ window.theme.primary, window.theme.danger ],
				borderWidth : 5
			} ]
		},
		options : {
			responsive : !window.MSInputMethodContext,
			maintainAspectRatio : false,
			legend : {
				display : false
			},
			cutoutPercentage : 75
		}
	});
});
</script>


<script>
	document.addEventListener("DOMContentLoaded", function() {
		var ctx = document.getElementById("chartjs-dashboard-line").getContext(
				"2d");
		var gradient = ctx.createLinearGradient(0, 0, 0, 225);
		gradient.addColorStop(0, "rgba(215, 227, 244, 1)");
		gradient.addColorStop(1, "rgba(215, 227, 244, 0)");
		// Line chart
		new Chart(document.getElementById("chartjs-dashboard-line"), {
			type : "line",
			data : {
				labels : [ "00:00", "01:00", "02:00", "03:00", "04:00",
						"05:00", "06:00", "07:00", "08:00", "09:00", "10:00",
						"11:00", "12:00", "13:00", "14:00", "15:00", "16:00",
						"17:00", "18:00", "19:00", "20:00", "21:00", "22:00",
						"23:00", "24:00" ],
				datasets : [ {
					label : "판매금 (원): ",
					fill : true,
					backgroundColor : gradient,
					borderColor : window.theme.primary,
					data : [ 2115, 1562, 1584, 1892, 1587, 1923, 2566, 2448,
							2805, 3438, 2917, 3327, 2115, 1562, 1584, 1892,
							1587, 1923, 2566, 2448, 2805, 3438, 2917, 3327 ]
				} ]
			},
			options : {
				maintainAspectRatio : false,
				legend : {
					display : false
				},
				tooltips : {
					intersect : false
				},
				hover : {
					intersect : true
				},
				plugins : {
					filler : {
						propagate : false
					}
				},
				scales : {
					xAxes : [ {
						reverse : true,
						gridLines : {
							color : "rgba(0,0,0,0.0)"
						}
					} ],
					yAxes : [ {
						ticks : {
							stepSize : 1000
						},
						display : true,
						borderDash : [ 3, 3 ],
						gridLines : {
							color : "rgba(0,0,0,0.0)"
						}
					} ]
				}
			}
		});
	});
</script>


<script>
	document.addEventListener("DOMContentLoaded", function() {
		// Bar chart
		new Chart(document.getElementById("chartjs-bar"), {
			type : "bar",
			data : {
				labels : [ "00:00", "01:00", "02:00", "03:00", "04:00",
					"05:00", "06:00", "07:00", "08:00", "09:00", "10:00",
					"11:00", "12:00", "13:00", "14:00", "15:00", "16:00",
					"17:00", "18:00", "19:00", "20:00", "21:00", "22:00",
					"23:00", "24:00" ],
				datasets : [ {
					label : "어제",
					backgroundColor : "#dee2e6",
					borderColor : "#dee2e6",
					hoverBackgroundColor : "#dee2e6",
					hoverBorderColor : "#dee2e6",
					data : lastDayChart,
					barPercentage : .75,
					categoryPercentage : .5
				}, {
					label : "오늘",
					backgroundColor : window.theme.primary,
					borderColor : window.theme.primary,
					hoverBackgroundColor : window.theme.primary,
					hoverBorderColor : window.theme.primary,
					data : [ 0, 40, 0, 40, 50, 50, 40, 50, 60, 70, 50, 0, 0, 60, 40, 30, 40, 50, 50, 40, 50, 60, 70, 50, 60, 40],
					barPercentage : .75,
					categoryPercentage : .5
				} ]
			},
			options : {
				maintainAspectRatio : false,
				legend : {
					display : false
				},
				scales : {
					yAxes : [ {
						gridLines : {
							display : false
						},
						stacked : false,
						
					} ],
					xAxes : [ {
						stacked : false,
						gridLines : {
							color : "transparent"
						}
					} ]
				}
			}
		});
	});
</script>










</body>

</html>